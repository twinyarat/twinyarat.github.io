<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Tutch Sottithat Winyarat | A collection of robotics research related to Computer Vision and State Estimation</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Tutch Sottithat Winyarat" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A collection of robotics research related to Computer Vision and State Estimation" />
<meta property="og:description" content="A collection of robotics research related to Computer Vision and State Estimation" />
<link rel="canonical" href="twinyarat.github.io/notes/quaternion/" />
<meta property="og:url" content="twinyarat.github.io/notes/quaternion/" />
<meta property="og:site_name" content="Tutch Sottithat Winyarat" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Tutch Sottithat Winyarat" />
<script type="application/ld+json">
{"description":"A collection of robotics research related to Computer Vision and State Estimation","url":"twinyarat.github.io/notes/quaternion/","headline":"Tutch Sottithat Winyarat","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="twinyarat.github.io/feed.xml" title="Tutch Sottithat Winyarat" /><!-- for mathjax support -->
	
	  <script type="text/x-mathjax-config">
	    MathJax.Hub.Config({
	    TeX: { equationNumbers: { autoNumber: "AMS" } }
	    });
	  </script>
	  <script type="text/javascript" async src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
	
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Tutch Sottithat Winyarat</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/notes/">Notes</a><a class="page-link" href="/projects/">Projects</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title"></h1>
  </header>

  <div class="post-content">
    <script type="text/javascript" async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<h3 id="unit-quaternions-and-rotation-of-rigid-bodies"><strong>Unit Quaternions and Rotation of Rigid Bodies</strong></h3>
<hr />
<hr />
<p>\(\)</p>

<p>In the year 1843 William Rowan Hamilton discovered a special class of a noncommutative division algebra whose members are analogous to the four dimensional complex numbers. Of this special class are <em>quaternions</em></p>

\[\boldsymbol{q} = q_0 + q_1\boldsymbol{i} + q_2\boldsymbol{j} + q_3\boldsymbol{k} = (q_0, \vec{q})\]

<p>where \(q_0,q_1,q_2,q_3 \in \mathbb{R}\) and \(\boldsymbol{i}, \boldsymbol{j}, \boldsymbol{k}\) are three imaginary unit bases obeying the fundamental quaternion multiplication law</p>

\[\boldsymbol{i}^2 =  \boldsymbol{j}^2 = \boldsymbol{k}^2 =  \boldsymbol{i} \boldsymbol{j} \boldsymbol{k} = -1\]

\[\boldsymbol{i}\boldsymbol{j} = -\boldsymbol{j}\boldsymbol{i} = \boldsymbol{k}\]

\[\boldsymbol{j} \boldsymbol{k} = -\boldsymbol{k}\boldsymbol{j} = \boldsymbol{i}\]

\[\boldsymbol{k} \boldsymbol{i} = -\boldsymbol{i}\boldsymbol{k} = \boldsymbol{j}\]

<p>To multiply two quaternions \(\boldsymbol{p}\) and \(\boldsymbol{q}\), we write</p>

\[\begin{align*} \boldsymbol{p}\boldsymbol{q} &amp;=  (p_0, \vec{p})(q_0, \vec{q}) \\
&amp;= (p_0 + p_1\boldsymbol{i} + p_2\boldsymbol{j} + p_3\boldsymbol{k})(q_0 + q_1\boldsymbol{i} + q_2\boldsymbol{j} + q_3\boldsymbol{k})\\[0.8em]
&amp;= p_0q_0 - (p_1q_1 + p_2q_2 + p_3q_3)+ p_0(q_1\boldsymbol{i} + q_2\boldsymbol{j} + q_3\boldsymbol{k}) + q_0(p_1\boldsymbol{i} + p_2\boldsymbol{j} + p_3\boldsymbol{k}) + \\
&amp; \space \space (p_2p_3-p_3q_2)\boldsymbol{i} + 
(p_3q_1-p_1q_3)\boldsymbol{j} + (p_1q_2-p_2q_1)\boldsymbol{k} \\[0.8em]
&amp;= p_0q_0 - \vec{p} \cdot \vec{q} + p_0\vec{q} +q_0\vec{p} + \vec{p} \times \vec{q} \\[0.8em]
&amp;= \bigg(p_0I + \begin{bmatrix} 0 &amp; -\vec{p}^T \\ \vec{p} &amp; [\hat{\vec{p}}] \end{bmatrix}\bigg) \boldsymbol{q} := [\boldsymbol{p}]_{L}\boldsymbol{q} \\[0.8em]
&amp;\text{where } [\hat{\vec{p}}] \text{ is the matrix equivalence of the cross product with } \vec{p} \\[0.8em]
&amp;= \bigg(q_0I + \begin{bmatrix} 0 &amp; -\vec{q}^T \\ \vec{q} &amp; -[\hat{\vec{q}}] \end{bmatrix}\bigg) \boldsymbol{p} = [\boldsymbol{q}]_{R}\boldsymbol{p}\\[0.8em]
&amp;\neq \boldsymbol{q}\boldsymbol{p}
\end{align*}\]

<p>Call \([\boldsymbol{p}]_{L}\) and \([\boldsymbol{q}]_{R}\) the left and right quaternion-product matrices, respectively.</p>

<p>The multiplicative inverse of a quaternion, \(\boldsymbol{q}^{-1}\), can be obtained by observing first that the norm of \(\boldsymbol{q}\) is</p>

\[\begin{align*}
 \lVert \boldsymbol{q} \rVert = \sqrt{\boldsymbol{q}\boldsymbol{q}^*} = \sqrt{\boldsymbol{q}^*\boldsymbol{q}} 
\end{align*}\]

<p>so that \(\boldsymbol{q}^{-1}\boldsymbol{q} = 1\) returns an identity. From this desired condition, we second observe that</p>

\[\begin{align*} \boldsymbol{q}^{-1}\boldsymbol{q} &amp;= 1 \\[0.8em]
&amp;= \tfrac{\lVert \boldsymbol{q} \rVert^2}{\lVert \boldsymbol{q} \rVert^2} \\[0.8em]
&amp;= \tfrac{\boldsymbol{q^*}\boldsymbol{q}}{\lVert \boldsymbol{q} \rVert^2} \\[0.8em]
\end{align*}\]

<p>Therefore, \(\boldsymbol{q}^{-1}  = \tfrac{\boldsymbol{q^*}}{\lVert \boldsymbol{q} \rVert^2}\) must hold true.</p>

<hr />
<p>\(\)</p>
<h4 id="unit-quaternions"><strong>Unit Quaternions</strong></h4>

<p>While applications of quaternions spread far across various quantitative fields, we will restrict ourselves to the class of unit quaternions used to describe rotations of rigid bodies. The unit quaternions \(\boldsymbol{q}\) , as their names imply, have unit length:</p>

\[\boldsymbol{q}\boldsymbol{q}^* = q_0^2 + q_1^2 + q_2^2 + q_3^2 = 1\]

<p>where \(\boldsymbol{q}^* = (q, -\vec{q})\) denotes the conjugate of \(\boldsymbol{q}\).</p>

<p>The connection between the unit quaternions and <a href="\notes\rodrigues">exponential coordinates</a>  of rotation is strong. To see  this connection, let us first reestablish a known result and from it walk back towards rediscovering an equivalent representation obtained from Rodrigues’ formula. This known result states that to rotate a vector \(\vec{p} \in \mathbb{R}^3\) by \(\theta\) about a unit axis \(\vec{u}\), we multiply three quaternions like so</p>

\[\boldsymbol{q} \boldsymbol{p} \boldsymbol{q}^*\]

<p>where \(\boldsymbol{p} = (0, \vec{p})\) and \(\boldsymbol{q} = (cos(\tfrac{\theta}{2}), sin(\tfrac{\theta}{2})\vec{u})\) is of unit length.
Proceed by performing the left multiplication:</p>

\[\scriptsize{ \begin{align*} \boldsymbol{q}\boldsymbol{p} &amp;= (cos(\tfrac{\theta}{2}), sin(\tfrac{\theta}{2})\vec{u})(0, \vec{p}) \\[0.8em] \tag{1}
&amp;= cos(\tfrac{\theta}{2})\cdot 0 -(sin(\tfrac{\theta}{2}) \vec{u}\cdot \vec{p}) +cos(\tfrac{\theta}{2})\vec{p} + 0(sin(\tfrac{\theta}{2})\vec{u}) +sin(\tfrac{\theta}{2})\vec{u} \times \vec{p} \\[0.8em]
&amp;= (-(sin(\tfrac{\theta}{2}) \vec{u}\cdot \vec{p} \space , \space cos(\tfrac{\theta}{2})\vec{p}  + sin(\tfrac{\theta}{2})\vec{u} \times \vec{p} ) \\[0.8em]
&amp;\text{Then right multiplying by the conjugate yields}\\
\boldsymbol{q}\boldsymbol{p}\boldsymbol{q^*} &amp;= \bigg(-(sin(\tfrac{\theta}{2}) \vec{u}\cdot \vec{p} \space , \space cos(\tfrac{\theta}{2})\vec{p}  + sin(\tfrac{\theta}{2})\vec{u} \times \vec{p} \bigg) \bigg(cos(\tfrac{\theta}{2}), -sin(\tfrac{\theta}{2})\vec{u} \bigg) \\[0.8em]
&amp;= \space -cos(\tfrac{\theta}{2})sin(\tfrac{\theta}{2})\vec{u}\cdot \vec{p} + cos(\tfrac{\theta}{2})sin(\tfrac{\theta}{2})\vec{p}\cdot \vec{u} +  sin^2(\tfrac{\theta}{2})(\vec{u} \times \vec{p}) \cdot \vec{u} \\
&amp;  \space\space \space \space + (sin^2(\tfrac{\theta}{2})\vec{u} \cdot \vec{p})\vec{u} + cos(\tfrac{\theta}{2})\bigg\{ cos(\tfrac{\theta}{2})\vec{p} + sin(\tfrac{\theta}{2})(\vec{u} \times \vec{p})  \bigg\} \\
&amp;  \space\space \space \space - cos(\tfrac{\theta}{2})sin(\tfrac{\theta}{2})(\vec{p} \times \vec{u}) -sin^2(\tfrac{\theta}{2})(\vec{u} \times \vec{p}) \times \vec{u} \\[0.8em]
&amp;= (sin^2(\tfrac{\theta}{2})\vec{u} \cdot \vec{p})\vec{u} +  cos^2(\tfrac{\theta}{2})\vec{p} + 2cos(\tfrac{\theta}{2})sin(\tfrac{\theta}{2})(\vec{u} \times \vec{p})  \underbrace{\space  -sin^2(\tfrac{\theta}{2})(\vec{u} \times \vec{p}) \times \vec{u}}_{+sin^2(\tfrac{\theta}{2})(\vec{u}\vec{u}^T - \vec{u}^T\vec{u}I)\vec{p}} \\[0.8em]
&amp;= \bigg\{ \big( cos^2(\tfrac{\theta}{2})-sin^2(\tfrac{\theta}{2})\vec{u}^T\vec{u} \big)I + 2cos(\tfrac{\theta}{2})sin(\tfrac{\theta}{2})[\boldsymbol{\hat{u}}] + 2sin^2(\tfrac{\theta}{2}) \vec{u}\vec{u}^T   \bigg\} \vec{p} \\
&amp;= \bigg\{ (q_0^2 - \vec{q}^T\vec{q})I +2q_0[\boldsymbol{\hat{\vec{q}}}] + 2\vec{q}\vec{q}^T \bigg\} \vec{p} \tag{2}
\end{align*}  }\]

<hr />
<p>\(\)</p>
<h4 id="rodrigues-formula-twice"><strong>Rodrigues’ Formula Twice</strong></h4>

<p>Recall from this <a href="\notes\rodrigues">note</a> that we can write a matrix \(\boldsymbol{R}\) representing a rotation by \(\theta\) about \(\vec{u}\) by applying Rodrigues’ formula twice: Rotate first by \(\frac{\theta}{2}\) and rotate once again by the remaining \(\frac{\theta}{2}\) about the same axis \(u\).</p>

\[\scriptsize{ \begin{align*} \boldsymbol{R} &amp;=
\bigg(  cos(\tfrac{\theta}{2})I + uu^T(1-cos(\tfrac{\theta}{2})) + sin(\tfrac{\theta}{2})[\boldsymbol{\hat{u}}]     \bigg)\bigg(  cos(\tfrac{\theta}{2})I + uu^T(1-cos(\tfrac{\theta}{2})) + sin(\tfrac{\theta}{2})[\boldsymbol{\hat{u}}]    \bigg) \\[0.8em]
&amp;= cos^2(\tfrac{\theta}{2})I + 2uu^T(1-cos(\tfrac{\theta}{2}))cos(\tfrac{\theta}{2}) + cos(\tfrac{\theta}{2})sin(\tfrac{\theta}{2})[\boldsymbol{\hat{u}}]I + (1-cos(\tfrac{\theta}{2}))^2uu^T + cos(\tfrac{\theta}{2})sin(\tfrac{\theta}{2})[\boldsymbol{\hat{u}}]I -sin^2(\tfrac{\theta}{2})(u^TuI -uu^T) \\[0.8em]
&amp;= cos^2(\tfrac{\theta}{2})I + 2uu^T(cos(\tfrac{\theta}{2})-cos^2(\tfrac{\theta}{2})) + (1-2cos(\tfrac{\theta}{2})+cos^2(\tfrac{\theta}{2}))uu^T + 2cos(\tfrac{\theta}{2})sin(\tfrac{\theta}{2})[\boldsymbol{\hat{u}}] +sin^2(\tfrac{\theta}{2})uu^T -sin^2(\tfrac{\theta}{2})u^Tu \\[0.8em]
&amp;= \big( cos^2(\tfrac{\theta}{2}) -sin^2(\tfrac{\theta}{2})u^Tu \big)I + 2 cos(\tfrac{\theta}{2})sin(\tfrac{\theta}{2})[\boldsymbol{\hat{u}}] + 2sin^2(\tfrac{\theta}{2})uu^T \\[0.8em]
&amp;\text{By defining a unit quaternion as we did in eq.1: } \boldsymbol{q} = (q_0, \vec{q}) = (cos(\tfrac{\theta}{2}),  sin(\tfrac{\theta}{2})\vec{u}), \\[0.8em]
&amp;= \bigg\{ (q_0^2 - \vec{q}^T\vec{q})I +2q_0[\boldsymbol{\hat{\vec{q}}}] + 2\vec{q}\vec{q}^T \bigg\} 
\end{align*} }\]

<p>Rodrigues has brought us back to the quaternion products in eq.2.</p>

<hr />
<hr />


  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Tutch Sottithat Winyarat</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Tutch Sottithat Winyarat</li><li><a class="u-email" href="mailto:winyarat AT seas DOT upenn DOT edu">winyarat AT seas DOT upenn DOT edu</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/twinyarat"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">twinyarat</span></a></li><li><a href="https://www.linkedin.com/in/winyarat"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">winyarat</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>A collection of robotics research related to Computer Vision and State Estimation</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
